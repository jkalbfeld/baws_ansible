- name: include vagrant vars
  include_vars: vagrant.yml
  tags:
   - vagrant

- stat: path=/usr/bin/drush
  register: drush
  tags:
   - drush
   - dev
   - burris_builder
   - drupal7
   - drupal8

- name: install drush
  get_url: url=http://files.drush.org/drush.phar dest=/usr/bin/drush mode=ugo+x
  notify:
   - initial drush run
  when: not drush.stat.exists
  tags:
   - drush
   - dev
   - burris_builder
   - drupal_site


- name: setting drupal settings according to import
  template: src=drupal.settings.j2 dest={{ site_root }}/{{site_name}}/sites/default/settings.php
  vars:
   drupal_db_name: "{{mysql_db}}"
   drupal_db_user: "{{mysql_user}}"
   drupal_db_pass: "{{mysql_pass}}"
   drupal_db_host: "{{db_host}}"
  tags:
   - local_db_import
   - drupal7

- name: composer install
  become_user: "{{ssh_user}}"
  shell: composer install --no-interaction --prefer-dist
  args:
    chdir: "/var/www/html/{{site_name}}"
    creates: "/var/www/html/{{site_name}}/vendor"
  tags:
   - composer_install